<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Token Auth App</title>
  <style>
    body { font-family: Arial; background: #f3f4f6; padding: 20px; }
    .card { background: white; padding: 20px; border-radius: 10px; width: 300px; margin: auto; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; }
    button { background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1d4ed8; }
  </style>
</head>
<body>

<div class="card" id="auth-card">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Register</button>
</div>

<div class="card" id="dashboard" style="display:none;">
  <h2>Welcome</h2>
  <p id="user-info"></p>
  <button onclick="logout()">Logout</button>
</div>

<script>
const API_URL = "/api/auth";

async function register() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const name = prompt("Enter your name:");
  const res = await fetch(`${API_URL}/register`, {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, password })
  });
  const data = await res.json();
  if (data.token) {
    localStorage.setItem("token", data.token);
    showDashboard(data.token);
  } else {
    alert(data.message);
  }
}

async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const res = await fetch(`${API_URL}/login`, {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });
  const data = await res.json();
  if (data.token) {
    localStorage.setItem("token", data.token);
    showDashboard(data.token);
  } else {
    alert(data.message);
  }
}

async function showDashboard(token) {
  const res = await fetch(`${API_URL}/profile`, {
    headers: { "Authorization": `Bearer ${token}` }
  });
  const data = await res.json();
  if (data.user) {
    document.getElementById("auth-card").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    document.getElementById("user-info").innerText = `Hello, ${data.user.name}`;
  } else {
    logout();
  }
}

function logout() {
  localStorage.removeItem("token");
  document.getElementById("auth-card").style.display = "block";
  document.getElementById("dashboard").style.display = "none";
}

window.onload = () => {
  const token = localStorage.getItem("token");
  if (token) showDashboard(token);
};
</script>
</body>
</html>
