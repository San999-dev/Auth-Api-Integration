<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Auth App - Token Based</title>
<style>
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(to right, #2c3e50, #3498db);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
.container {
  width: 100%;
  max-width: 400px;
  background: #fff;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
h2 {
  text-align: center;
  color: #3498db;
  margin-bottom: 20px;
}
form {
  display: flex;
  flex-direction: column;
}
input, button {
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
}
button {
  background: #3498db;
  color: white;
  border: none;
  cursor: pointer;
  transition: background 0.3s;
}
button:hover {
  background: #217dbb;
}
.screen {
  display: none;
}
.screen.active {
  display: block;
}
p a {
  color: #3498db;
  cursor: pointer;
  text-decoration: underline;
}
.toggle-password {
  position: relative;
}
.toggle-password span {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  color: #666;
  cursor: pointer;
}
.actions {
  display: flex;
  justify-content: space-between;
}
</style>
</head>
<body>
<div class="container">

  <!-- LOGIN -->
  <section id="login" class="screen active">
    <h2>Login</h2>
    <form id="login-form">
      <input type="text" id="login-email" placeholder="Email" required />
      <div class="toggle-password">
        <input type="password" id="login-password" placeholder="Password" required />
        <span onclick="togglePassword('login-password', this)">Show</span>
      </div>
      <button type="submit">Login</button>
      <p><a onclick="switchScreen('forgot')">Forgot Password?</a></p>
      <p><a onclick="switchScreen('register')">Don't have an account? Register</a></p>
    </form>
  </section>

  <!-- REGISTER -->
  <section id="register" class="screen">
    <h2>Register</h2>
    <form id="register-form">
      <input type="text" id="register-name" placeholder="Full Name" required />
      <input type="email" id="register-email" placeholder="Email" required />
      <div class="toggle-password">
        <input type="password" id="register-password" placeholder="Password" required />
        <span onclick="togglePassword('register-password', this)">Show</span>
      </div>
      <button type="submit">Register</button>
      <p><a onclick="switchScreen('login')">Already have an account? Login</a></p>
    </form>
  </section>

  <!-- FORGOT PASSWORD -->
  <section id="forgot" class="screen">
    <h2>Forgot Password</h2>
    <form id="forgot-form">
      <input type="email" id="forgot-email" placeholder="Enter your registered email" required />
      <button type="submit">Recover Password</button>
      <p><a onclick="switchScreen('login')">Back to Login</a></p>
    </form>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="screen">
    <h2>Welcome</h2>
    <p id="user-info">Welcome back!</p>
    <div class="actions">
      <button onclick="logout()">Logout</button>
    </div>
  </section>

</div>

<script>
const API_BASE = "https://your-api-endpoint.com"; // Change to your API URL

const switchScreen = (id) => {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
};

const togglePassword = (inputId, toggleElem) => {
  const input = document.getElementById(inputId);
  if (input.type === "password") {
    input.type = "text";
    toggleElem.textContent = "Hide";
  } else {
    input.type = "password";
    toggleElem.textContent = "Show";
  }
};

// LOGIN
document.getElementById("login-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value;

  try {
    const res = await fetch(`${API_BASE}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    if (!res.ok) throw new Error("Invalid credentials");

    const data = await res.json();
    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));

    document.getElementById("user-info").textContent = `Hello, ${data.user.name}`;
    switchScreen("dashboard");

  } catch (err) {
    alert(err.message);
  }
});

// REGISTER
document.getElementById("register-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("register-name").value.trim();
  const email = document.getElementById("register-email").value.trim();
  const password = document.getElementById("register-password").value;

  try {
    const res = await fetch(`${API_BASE}/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, password })
    });

    if (!res.ok) throw new Error("Registration failed");

    alert("Registration successful! Please login.");
    switchScreen("login");
  } catch (err) {
    alert(err.message);
  }
});

// FORGOT PASSWORD
document.getElementById("forgot-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("forgot-email").value.trim();

  try {
    const res = await fetch(`${API_BASE}/forgot-password`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    if (!res.ok) throw new Error("Email not found");

    alert("Password recovery instructions sent to your email.");
    switchScreen("login");
  } catch (err) {
    alert(err.message);
  }
});

// AUTO LOGIN
window.onload = async () => {
  const token = localStorage.getItem("token");
  if (token) {
    try {
      const res = await fetch(`${API_BASE}/me`, {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!res.ok) throw new Error("Session expired");

      const user = await res.json();
      document.getElementById("user-info").textContent = `Hello, ${user.name}`;
      switchScreen("dashboard");
    } catch {
      logout();
    }
  }
};

// LOGOUT
const logout = () => {
  localStorage.removeItem("token");
  localStorage.removeItem("user");
  switchScreen("login");
};
</script>
</body>
</html>
